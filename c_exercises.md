# Linux系统下的C编程练习

练习的同时检查贯彻c编码规范。

## 练习清单

- C01: 结构体对齐和指针访问；
- C02: 命令行显示控制；
- C03: 计算文件crc16；
- C04: 数据加工处理；
- C07: 串口Terminal
- C10: udp测量网络带宽和时延；
- C11: tcp socket通信和故障处理； 
- C12: 基于libcurl调用http api和上传、下载
- C20: 类格雷码变换；

## 练习C01 结构体对齐和指针访问

编写命令行程序实现以下功能：

- 定义一个包含字符、短整数、整数、浮点数、字符块的结构体，打印结构体大小；
- 修改对齐方式为默认对齐、2字节、1字节，查看结构体大小n；
- 用该结构体创建变量，用指针以字节方式给结构体变量对应的内存块的每个字节依次赋值0x01、0x02、0x03...0x0n；
- 以十六进制及合适的字节长度，打印每种对齐方式下结构体各变量的数值；
- 口头说明每种对齐方式下，每个变量在结构体内存块的分布位置；

## 练习C02 命令行显示控制

编写命令行程序实现以下功能：

- 按“年-月-日 时:分:秒   十进制随机数”格式显示一行内容，其中时间为当前时间，随机数每秒变换一次；
- 年显示4位数，月、日、时、分、秒显示2位数，十位为0也要显示；
- 程序只有一行输出，时间和随机数在原位置变换（时间显示左对齐，随机数显示右对齐）；
- 年月日用兰色，时分秒用绿色，随机数用红色；
- 光标停留在随机数末尾；

## 练习C03: 计算文件crc16

编写命令行程序实现以下功能：

- 从命令行参数获得用户指定文件；
- 计算该文件的crc16值（移位法和查表法）；
- 生成10G字节大文件，内容为随机数；
- 计算该文件的crc16，打印耗时；
- 对比两种方法的计算速度；

## 练习C04: 数据加工处理

本联系模拟压缩/解压缩、加密/解密等数据处理过程；

1. 定义一个结构体A，包含字符、字符数组、短整数、整数等成员变量，字符数组取长度17；
2. 动态分配A的变量a1，依次给结构体每个成员赋值；
3. 将a1指向的内存块按高位在前4字节整数为单位，计算整数累加和，不足4字节的用0补齐；注意，是高位在前！！！
4. 以16进制方式打印本次计算得到的累加和；
5. 重复步骤2~3若干次（32次以上），依次分配变量a2、a3、...，赋值并计算累加和，检查每次打印出来的累加和是否一致。

## 练习C07: 串口Terminal

先用MiniCom连接开发板体验串口terminal使用效果。

利用select、epoll等查询机制，不使用多线程实现以下功能：

- 从命令行参数获取串口、波特率；
- 连接一块嵌入式linux开发板的串口；
- 显示串口收到的开发板系统输出；
- 显示命令行提示符，显示用户的键盘输入；
- 用户按回车后，将输入的命令发给串口；

## 练习C10 udp测量网络带宽和时延

一种测量网络及对端服务能力的简易方法：
- 连续发送N个请求（N应大于网络及对端服务能力，可以暂定一个数值，根据测试情况调整）
- 每收到一个请求的答复就发送一个新请求；
- 计算单位时间内收到的答复数量和时延；

利用select/epoll等查询机制，不使用多线程实现以下功能：

- 用udp socket编写程序，该程序监听指定端口，收到一个请求包后往来源地址发送一个答复包；按键触发往指定地址发送请求包；
- 设计请求包-答复包协议，使其能测量网络双向通信的带宽和时延；
- 利用C02相关方法，持续动态显示通信带宽和时延（在合适时间范围内计算平均带宽和时延）；
- 编译后运行两个实例，分别赋予不同端口，互相作为对端地址；
- 在不同机器上，测量双向最大带宽和时延，分析改进；

## 练习C11 tcp socket通信和故障处理

- 基于tcp socket和select/epoll查询机制编写一个客户端和一个服务端；
- 服务端允许多个客户端接入，最多使用2个线程（包含主线程）；
- 客户端通过命令行参数获得服务端地址，
- 客户端每15秒发送一次心跳，服务端收到后给予答复（自行设计协议）；
- 服务端启动后显示提示符，允许键盘输入指令；
- 服务端可以通过键盘指令控制是否答复指定客户端连接的心跳（自行设计如何区分客户端），关闭答复时，服务端不会答复客户端的心跳，但仍然保持tcp连接；
- 客户端连续3次未收到服务端心跳答复时，断开tcp重新连接；
- 尝试在不同机器上运行客户端和服务端，若网络不通，客户端每隔10秒重新尝试连接服务端；
- 不同机器运行时，杀死客户端进程，测试服务端能否立即发现；
- 不同机器运行时，杀死服务端进程，测试客户端能否立即发现；
- 不同机器运行时，拔掉网线，分别测试客户端多久发现断网，服务端多久发现断网；
- 不同机器运行时，通过指令关闭服务端对某客户端的答复，测试客户端多久发起重连；


## 练习C12 基于libcurl调用http api和上传、下载

基于配套提供的服务器编写以下试验：

- 通过命令行参数获取服务器地址，这里假定为 [server]；
- 显示提示符，允许用户通过键盘输入指令；
- 用户输入 api [url] 时，通过libcurl发起请求 [server/url]
- 显示服务器原始答复，用开源json库解析服务器答复内容；
- 拔掉网线，软件应能判断断网；
- 用户输入 download [url]时，通过libcurl下载指定文件，且能显示下载进度；
- 用户输入 upload [path]时，通过libcurl上传指定文件，且能显示上传进度；

## 练习C20: 类格雷码变换

- 从命令行参数获取位数n、进制数a；
- 输出n位a进制数的每种组合，不得重复，相邻两行数字只能有1位数字发生变化；

```
    例如，n=3, a=3的一种符合要求的输出为
    000
    001
    002
    012
    011
    010
    020
    021
    022
    ...
```
